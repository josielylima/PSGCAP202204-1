DECLARE @CURSOR INT
DECLARE @STOPCURSOR INT 
DECLARE @COUNT BIGINT
DECLARE @RESULT BIGINT
DECLARE @FREQUENCY TABLE(
	ID_FREQ BIGINT NOT NULL IDENTITY(1,1),
	RESULT BIGINT NOT NULL
)
DECLARE @MINID BIGINT
DECLARE @CHANGED BIT

SET @CURSOR = 100
SET @STOPCURSOR = 0
SET @MINID = (SELECT MIN(ID_Funcionario) FROM FuncionarioTemp)

WHILE (@CURSOR <> @STOPCURSOR)
BEGIN
	SET @COUNT = (SELECT COUNT(ID_Funcionario) FROM FuncionarioTemp) + 1
	SET @RESULT = (SELECT FLOOR(RAND()*(@COUNT-1)+1))

	IF (@RESULT > @MINID)
	BEGIN
		SET @CHANGED = (SELECT Situacao FROM FuncionarioTemp WHERE ID_Funcionario = @RESULT)
		IF (@CHANGED = 1)
		BEGIN
			INSERT INTO @FREQUENCY(RESULT) VALUES(@RESULT)
			SET @STOPCURSOR = @STOPCURSOR + 1
		END
	END
END

DECLARE DB_CURSOR CURSOR FOR
	SELECT RESULT FROM @FREQUENCY ORDER BY RESULT

DECLARE @KEY BIGINT

OPEN DB_CURSOR FETCH NEXT FROM DB_CURSOR INTO @KEY

WHILE @@FETCH_STATUS = 0  
BEGIN  
	UPDATE FuncionarioTemp
	SET Situacao = 0
	WHERE ID_Funcionario = @KEY

	FETCH NEXT FROM DB_CURSOR INTO @KEY
END 

CLOSE DB_CURSOR  
DEALLOCATE DB_CURSOR 

GO
